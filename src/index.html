<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <style>
            svg {
                margin: auto;
                width: auto;
                height: auto;
            }
            circle.clock {
                stroke: black;
                stroke-width: 3px;
                fill: none;
            }
            line.hand-large {
                stroke: black;
                stroke-width: 8px;
            }
            line.mark-large {
                stroke: black;
                stroke-width: 5px;
            }
            line.mark-small {
                stroke: black;
                stroke-width: 2px;
            }
        </style>
    </head>
    <body>
        <script>
            // angle of large hand
            let curAngleLarge = 3 * Math.PI / 2;
            // number of milliseconds in the timer
            let maxNumMilliseconds = 60 * 1000;
            // number of milliseconds per tick
            let tickSpeed = 100;
            // distance per tick
            // add 1% to correct for setInterval being slow
            // https://stackoverflow.com/questions/23981382/setinterval-delays-not-accurate
            let tickDistance = 2 * Math.PI * tickSpeed / maxNumMilliseconds * 1.01;
            // radius of circle
            let radius = 250;
            // current timer interval object
            let timer = undefined;
            function createMark(radius, angle, length, offset, className) {
                let mark = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                mark.setAttribute('class', className);
                let deltaX = Math.cos(angle) * length;
                let deltaY = Math.sin(angle) * length;
                let x1 = radius + Math.cos(angle) * (radius - length - offset);
                mark.setAttribute('x1', x1);
                let x2 = x1 + deltaX;
                mark.setAttribute('x2', x2);
                let y1 = radius + Math.sin(angle) * (radius - length - offset);
                mark.setAttribute('y1', y1)
                let y2 = y1 + deltaY;
                mark.setAttribute('y2', y2);
                return mark;
            }

            function generateClockMarkings() {
                // space between large marks
                let largeIncrement = 1/6 * Math.PI;
                // space between small marks
                let smallIncrement = largeIncrement / 5;
                // length of each large mark
                let largeLength = 30;
                // length of each small mark
                let smallLength = 20;
                // offset from clock circle for large marks
                let largeOffset = 0;
                // offset from clock circle for small marks
                let smallOffset = 10;
                let clock = document.getElementById('clock');

                // generate large markings
                for (let largeAngle=0; largeAngle<2 * Math.PI; largeAngle+=largeIncrement) {
                    clock.appendChild(createMark(radius, largeAngle, largeLength, largeOffset, 'mark-large'));
                    for (let smallAngle=largeAngle; smallAngle<largeAngle + largeIncrement; smallAngle+=smallIncrement) {
                        clock.appendChild(createMark(radius, smallAngle, smallLength, smallOffset, 'mark-small'))
                    }
                }
            }

            function renderLargeHand() {
                let largeHand = document.getElementById('hand-large');
                largeHand.setAttribute('x2', radius + Math.cos(curAngleLarge) * radius);
                largeHand.setAttribute('y2', radius + Math.sin(curAngleLarge) * radius);
            }

            function tickTimer() {
                curAngleLarge = (curAngleLarge + tickDistance);
                renderLargeHand();
            }

            // takes duration in milliseconds
            function startTimer(duration) {
                // clear any existing timers
                stopTimer();
                // calculate starting angle based on max time
                curAngleLarge = (maxNumMilliseconds - duration) / maxNumMilliseconds * 2*Math.PI - Math.PI/2;
                console.log(curAngleLarge)
                console.log(tickDistance)
                document.getElementById('sound-ticking').play();
                timer = setInterval(tickTimer, tickSpeed, tickDistance);
                setTimeout(stopTimer, duration);
            }

            function stopTimer() {
                clearInterval(timer);
                curAngleLarge = 3/2*Math.PI;
                renderLargeHand();
                document.getElementById('sound-ticking').pause();
            }

        </script>
        <form onsubmit="startTimer(document.getElementById('duration').value * 1000);return false;">
            Enter the amount of time you want the timer to be(in seconds): <input type=number max=60 min=1 id="duration"/>
            <input type="submit" value="Start timer" />
        </form>
        <svg xmlns='http://www.w3.org/2000/svg' height=500 width=500 id='clock' onLoad="generateClockMarkings();startTimer(59 * 1000)">
            <line x1='50%' y1='50%' x2='50%' y2='0%' class='hand-large' id='hand-large'/>
            <text x='50%' y='75%' fill='black' dominant-baseline="middle" text-anchor="middle">Timer</text>
        </svg>
        <audio hidden='true' src='./sounds/ticking.mp3' loop='true' id='sound-ticking'></audio>
    </body>
</html>